{
  "apiVersion": "nais.io/v1alpha1",
  "kind": "Alert",
  "metadata": {
    "name": "spsak-alerts",
    "labels": {
      "team": "tbd"
    }
  },
  "spec": {
    "receivers": {
      "slack": {
        "channel": "#spsak"
      }
    },
    "alerts": [
      {
        "alert": "sp-sak-har-ingen-aktive-pods",
        "expr": "up{app=~\"spsak\",job=\"kubernetes-pods\"} == 0",
        "for": "2m",
        "description": "spsak mangler aktive pods i produksjon!",
        "action": "Se `kubectl describe pod {{ $labels.kubernetes_pod_name }}` for events, og `kubectl logs {{ $labels.kubernetes_pod_name }}` for logger",
        "sla": "respond within 1h, during office hours",
        "severity": "danger"
      },
      {
        "alert": "spsak-mottar-ikke-sykmeldinger",
        "expr": "sum(increase(sykmeldinger_totals{app=\"spsak\"}[60m])) < 1 AND hour() > 8 AND hour() < 20",
        "for": "5m",
        "description": "spsak har ikke mottatt en eneste sykmelding siste timen",
        "action": "Se `kubectl describe pod {{ $labels.kubernetes_pod_name }}` for events, og `kubectl logs {{ $labels.kubernetes_pod_name }}` for logger",
        "sla": "respond within 1h, during office hours",
        "severity": "danger"
      },
      {
        "alert": "spsak-mottar-ikke-soknader",
        "expr": "sum(increase(soknader_totals{app=\"spsak\"}[60m])) < 1 AND hour() > 8 AND hour() < 20",
        "for": "5m",
        "description": "spsak har ikke mottatt en eneste sÃ¸knad siste timen",
        "action": "Se `kubectl describe pod {{ $labels.kubernetes_pod_name }}` for events, og `kubectl logs {{ $labels.kubernetes_pod_name }}` for logger",
        "sla": "respond within 1h, during office hours",
        "severity": "danger"
      }
    ]
  }
}
